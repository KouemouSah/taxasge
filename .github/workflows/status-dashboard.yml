# ============================================================================
# 3. CORRECTION status-dashboard.yml - Sans sed complexe
# ============================================================================

---
name: ğŸ“Š Status Dashboard Update

on:
  workflow_run:
    workflows: ["ğŸ“± Mobile CI/CD Production", "ğŸ Backend CI/CD Production"]
    types: [completed]
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update-dashboard:
    name: ğŸ“Š Update Status Dashboard
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      # âœ… CORRECTION: GÃ©nÃ©ration STATUS.md sans sed complexe
      - name: ğŸ“ Create Status Dashboard
        run: |
          REPO_NAME="${{ github.repository }}"
          CURRENT_DATE=$(date -u '+%Y-%m-%d %H:%M:%S UTC')
          
          cat > STATUS.md << EOF
          # ğŸš€ TaxasGE - Status Dashboard
          
          > **Last updated:** $CURRENT_DATE
          
          ## ğŸ”„ Build Status
          
          | Component | Status |
          |-----------|--------|
          | ğŸ“± Mobile App | ![Mobile CI](https://github.com/$REPO_NAME/workflows/ğŸ“±%20Mobile%20CI%2FCD%20Production/badge.svg) |
          | ğŸ Backend API | ![Backend CI](https://github.com/$REPO_NAME/workflows/ğŸ%20Backend%20CI%2FCD%20Production/badge.svg) |
          | ğŸš€ Deploy | ![Deploy](https://github.com/$REPO_NAME/workflows/Deploy%20Backend%20to%20Firebase/badge.svg) |
          
          ## ğŸ“Š Project Overview
          
          - ğŸ—ï¸ **Status:** MVP Development
          - ğŸ—„ï¸ **Database:** Supabase PostgreSQL
          - ğŸ¤– **AI Model:** Ready (0.41MB, 100% accuracy)
          - ğŸ“± **Platforms:** Android, iOS, Web
          
          ## ğŸŒ Environments
          
          | Environment | URL | Status |
          |-------------|-----|--------|
          | ğŸ§ª Development | [taxasge-dev.web.app](https://taxasge-dev.web.app) | Auto-deploy |
          | ğŸ­ Production | [taxasge-prod.web.app](https://taxasge-prod.web.app) | Manual deploy |
          
          ## ğŸ“‹ Progress Tracker
          
          ### âœ… Completed
          - [x] CI/CD Pipelines Setup
          - [x] Firebase Configuration
          - [x] AI Model Training
          - [x] Database Schema Design
          - [x] Supabase Integration
          
          ### ğŸš§ In Development
          - [ ] React Native Mobile App
          - [ ] Backend API Implementation
          - [ ] Payment Integration (Bange)
          - [ ] Web Admin Dashboard
          - [ ] Offline Chatbot Integration
          
          ## ğŸ”— Quick Access
          
          - ğŸ“Š [GitHub Actions](https://github.com/$REPO_NAME/actions)
          - ğŸ› [Issues](https://github.com/$REPO_NAME/issues)
          - ğŸ”€ [Pull Requests](https://github.com/$REPO_NAME/pulls)
          - ğŸ”¥ [Firebase Console](https://console.firebase.google.com/project/taxasge-dev)
          
          ---
          *ğŸ¤– Auto-generated by GitHub Actions*
          EOF
      
      - name: ğŸ’¾ Commit Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          if ! git diff --quiet STATUS.md; then
            git add STATUS.md
            git commit -m "ğŸ¤– Update status dashboard [skip ci]"
            git push
          else
            echo "No changes to commit"
          fi
